<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-document.html">
<link rel="import" href="../styles/app-styles.html">
<link rel="import" href="../player/player-avatar.html">
<link rel="import" href="../player/player-display-name.html">

<dom-module id="match-item">
  <template>
    <style include="app-styles"></style>
    <style>
    :host {
      display: block;
      padding: 0 16px;
      @apply --layout-flex;
    }
    .container {
      @apply --layout-flex;
      @apply --layout-horizontal;
    }
    :host([flipped]) .container {
      @apply --layout-horizontal-reverse;
    }
    .player-1, .player-2 {
      @apply --layout-flex;
      @apply --layout-horizontal;
      @apply --layout-center-center;
    }
    .player-2 {
      @apply --layout-horizontal-reverse;
    }
    :host([flipped]) .player-1 {
      @apply --layout-horizontal-reverse;
    }
    :host([flipped]) .player-2 {
      @apply --layout-horizontal;
    }
    .info {
      @apply --layout-flex;
      @apply --layout-vertical;
      @apply --layout-center-justified;
    }
    .player-2 .info {
      text-align: right;
    }
    :host([flipped]) .player-2 .info {
      text-align: left;
    }
    :host([flipped]) .player-1 .info {
      text-align: right;
    }
    .body {
      @apply --layout-flex;
      @apply --layout-horizontal;
      @apply --layout-center-justified;
    }
    .ratings {
      @apply --ppaer-font-body1;
      color: var(--secondary-text-color);
    }
    .score {
      font-size: 2rem;
      margin: 0;
    }
    :host([player-uid][player-uid-won]) .score {
      color: var(--paper-green-900);
    }
    :host([player-uid]:not([player-uid-won])) .score {
      color: var(--paper-red-900);
    }
    .divider {
      margin: 1rem;
    }
    player-avatar + .info {
      margin: 1rem;
    }

    @media (max-width: 767px) {
      :host {
        position: relative;
      }
      .player-1, .player-2 {
        position: relative;
        overflow: hidden;
      }
      /*player-avatar {
        opacity: 0.15;
      }*/
      /*:host([flipped]) .player-2 player-avatar,
      .player-1 player-avatar {
        position: absolute;
        right:0;
        top:0;
      }
      :host([flipped]) .player-1 player-avatar,
      .player-2 player-avatar {
        position: absolute;
        left:0;
        top:0;
      }*/
      :host {
        padding: 0;
      }
      .divider {
        /*margin: 0;
        margin-bottom:1rem;
        margin-top:auto;*/
      }
      player-avatar + .info {
        /*margin: 0;*/
      }
      .info {
        /*font-size: 0.8rem;*/
        /*display: none;*/
        /*margin:0;*/
        /*z-index:1;*/
      }
      .ratings{
        display: none;
      }
      .score {
        font-size: 1rem;
      }
    }
    </style>
    <firebase-document data="{{player1}}" path="/players/[[match.player1Uid]]">
    </firebase-document>
    <firebase-document data="{{player2}}" path="/players/[[match.player2Uid]]">
    </firebase-document>

    <div class="container">
      <div class="player-1">
        <player-avatar src="[[player1.photoURL]]"></player-avatar>
          <div class="info">
            <span>
              <player-display-name value=[[player1.displayName]]></player-display-name>
            </span>
            <div class="ratings">
              <span>
                [[match.ratings.player1Prev]]
                <iron-icon icon="[[player1Icon]]"></iron-icon>
                [[match.ratings.player1New]]
              </span>
            </div>
          </div>
          <p class="score">[[match.scores.player1]]</p>
      </div>
      <span class="divider">-</span>
      <div class="player-2">
        <player-avatar src="[[player2.photoURL]]"></player-avatar>
          <div class="info">
            <span>
              <player-display-name value=[[player2.displayName]]></player-display-name>
            </span>
            <div class="ratings">
              <span>
                [[match.ratings.player2Prev]]
                <iron-icon icon="[[player2Icon]]"></iron-icon>
                [[match.ratings.player2New]]
              </span>
            </div>
          </div>
          <span class="score">[[match.scores.player2]]</span>
      </div>
    </div>
  </template>
  <script>
    class MatchItem extends Polymer.Element {
      static get is () { return 'match-item' }
      static get properties () {
        return {
          match: Object,
          playerUid: {
            type: String,
            reflectToAttribute: true
          },
          playerUidWon: {
            type: Boolean,
            reflectToAttribute: true,
            computed: '_computeplayerUidWon(playerUid, match)'
          },
          player1Icon: {
            type: Boolean,
            computed: '_computePlayerIcon(match.ratings.player1New, match.ratings.player1Prev)'
          },
          player2Icon: {
            type: Boolean,
            computed: '_computePlayerIcon(match.ratings.player2New, match.ratings.player2Prev)'
          },
          flipped: {
            type: Boolean,
            reflectToAttribute: true
          }
        }
      }
      _computeplayerUidWon (playerUid, match) {
        if (!playerUid || !match) return
        let p1Won = Number(match.scores.player1) > Number(match.scores.player2)
        return playerUid === match.player1Uid ? p1Won : !p1Won
      }
      _computePlayerIcon (newRating, prevRating) {
        if (newRating === prevRating) return 'trending-flat'
        return newRating > prevRating ? 'trending-up' : 'trending-down'
      }
    }

    window.customElements.define(MatchItem.is, MatchItem)
  </script>
</dom-module>

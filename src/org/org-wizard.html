<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../styles/dark-theme.html">
<link rel="import" href="../org/org-wizard-shared-styles.html">
<link rel="import" href="../org/org-join.html">
<link rel="import" href="../org/org-joined.html">
<link rel="import" href="../org/org-create.html">
<link rel="import" href="../org/org-created.html">

<dom-module id="org-wizard">
  <template>
    <style include="org-wizard-shared-styles"></style>
    <style>
      section {
        @apply --layout-flex;
        @apply --layout-vertical;
        @apply --layout-center-center;
      }
      header {
        margin: 1rem;
      }
      iron-selector > :not(.iron-selected) {
        display: none;
      }
      .back-button {
        position: fixed;
        left: 1rem;
        bottom: 1rem;
      }
    </style>

    <iron-selector id="selector" selected="[[step]]" attr-for-selected="name" activate-event="">
      <section name="start">
        <header>
          <h2>First time at CorpoPong?</h2>
        </header>
        <paper-button raised on-tap="_join">Join existing corp</paper-button>
        <a on-tap="_create">or create new one</a>
      </section>
      <section name="create">
        <org-create created-org="{{createdOrg}}" on-advanced="_advance"></org-create>
      </section>
      <section name="created">
        <org-created created-org="[[createdOrg]]" on-advanced="_advance"></org-created>
      </section>
      <section name="join">
        <org-join joined-org="{{joinedOrg}}" on-advanced="_advance"></org-join>
      </section>
      <section name="joined">
        <org-joined  joined-org="[[joinedOrg]]" on-advanced="_advance"></org-joined>
      </section>
    </iron-selector>
    <paper-icon-button
      class="back-button"
      icon="arrow-back"
      on-tap="_decrease"
      hidden="[[!_canDecrease]]">
    </paper-icon-button>

  </template>
  <script>
    class OrgWizard extends Polymer.Element {
      static get is () { return 'org-wizard' }
      static get properties () {
        return {
          step: {
            type: String,
            notify: true,
            value: () => 'start'
          },
          _steps: {
            type: Array,
            value: []
          },
          _canDecrease: {
            type: Boolean,
            value: false,
            computed: '_computeCanDecrease(_steps.length)'
          }
        }
      }
      _create () {
        this.push('_steps', this.step)
        this.step = 'create'
      }
      _join () {
        this.push('_steps', this.step)
        this.step = 'join'
      }
      _advance (e) {
        this.push('_steps', this.step)
        switch (this.step) {
          case 'create':
            this.step = 'created'
            this._steps = []
            break
          case 'join':
            this.step = 'joined'
            this._steps = []
            break
          default:
            this.dispatchEvent(new CustomEvent('finished'))
        }
      }
      _decrease () {
        this.step = this.pop('_steps')
      }
      _computeCanDecrease (stepsCount) {
        return stepsCount > 0
      }
    }

    window.customElements.define(OrgWizard.is, OrgWizard)
  </script>
</dom-module>

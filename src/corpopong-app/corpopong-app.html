<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/polymer/lib/utils/render-status.html">
<link rel="import" href="../../bower_components/lazy-imports/lazy-imports-mixin.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/app-active-route/app-active-route.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-app.html">
<link rel="import" href="../corpopong-app/login-component.html">
<link rel="import" href="../styles/app-theme.html">
<link rel="import" href="../styles/app-styles.html">

<dom-module id="corpopong-app">
  <link rel="lazy-import" group="lazy" href="../dashboard/dashboard-fragment.html">
  <link rel="lazy-import" group="lazy" href="../match/open-match-fragment.html">
  <link rel="lazy-import" group="lazy" href="../match/match-create-fragment.html">
  <link rel="lazy-import" group="lazy" href="../match/match-fragment.html">
  <link rel="lazy-import" group="lazy" href="../player/player-fragment.html">
  <link rel="lazy-import" group="lazy" href="../player/players-history-fragment.html">
  <link rel="lazy-import" group="lazy" href="../common/notifications-component.html">
  <template>
    <style include="app-styles"></style>
    <style>
      :host {
        display: block;
      }
    </style>
    <firebase-app
      auth-domain="corpopong-dev.firebaseapp.com"
      database-url="https://corpopong-dev.firebaseio.com"
      storage-bucket="corpopong-dev.appspot.com"
      api-key="AIzaSyB1jdeJaOejjpVtL5SOQrkiARsmAdeyuOk"
      messaging-sender-id="414017409980">
    </firebase-app>

    <app-location route="{{route}}"></app-location>
    <login-component user="{{user}}"></login-component>
    <notifications-component user-uid="[[user.uid]]"></notifications-component>
    <paper-toast text="New version available!" duration="-1" id="swToast">
      <a href="#" on-tap="_refresh">Refresh</a>
    </paper-toast>

    <app-active-route pattern="{{activePattern}}" fallback-pattern="/">
      <app-route route="[[route]]" pattern="/matches/create"></app-route>
      <app-route route="[[route]]" pattern="/open-matches/:id" data="{{openMatchData}}"></app-route>
      <app-route route="[[route]]" pattern="/matches/:id" data="{{matchData}}"></app-route>
      <app-route route="[[route]]" pattern="/players/:id1/history/:id2" data="{{historyData}}"></app-route>
      <app-route route="[[route]]" pattern="/players/:id" data="{{playersData}}"></app-route>
    </app-active-route>

    <iron-pages id="pages" selected="[[activePattern]]" attr-for-selected="for-pattern" selected-attribute="active">
      <dashboard-fragment for-pattern="/" user-uid="[[user.uid]]"></dashboard-fragment>
      <match-create-fragment for-pattern="/matches/create" user-uid="[[user.uid]]"></match-create-fragment>
      <open-match-fragment for-pattern="/open-matches/:id" user-uid="[[user.uid]]" match-uid="[[openMatchData.id]]"></open-match-fragment>
      <match-fragment for-pattern="/matches/:id" match-uid="[[matchData.id]]"></match-fragment>
      <player-fragment for-pattern="/players/:id" player-uid="[[playersData.id]]" user-uid="[[user.uid]]"></player-fragment>
      <players-history-fragment for-pattern="/players/:id1/history/:id2" player1-uid="[[historyData.id1]]" player2-uid="[[historyData.id2]]"></players-history-fragment>
    </iron-pages>

  </template>

  <script>
    class CorpopongApp extends Polymer.LazyImportsMixin(Polymer.Element) {
      static get is () { return 'corpopong-app' }
      ready () {
        super.ready()
        Polymer.RenderStatus.afterNextRender(this, () => {
          this.importLazyGroup('lazy').then(() => this.$.pages.notifyResize())
        })
      }
      static get listeners () {
        return {
          'sw-updated': '_notifyUpdate'
        }
      }
      _notifyUpdate () {
        console.log('new version!')
      }
      _refresh () {
        window.location.reload()
      }
    }
    window.customElements.define(CorpopongApp.is, CorpopongApp)
  </script>
</dom-module>

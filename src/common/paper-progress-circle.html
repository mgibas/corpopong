<link rel="import" href="../../bower_components/polymer/polymer-element.html">

<dom-module id="paper-progress-circle">
  <template>
    <style>
    :host {
      display: block;
      height: var(--size);
      width: var(--size);
      transition: opacity 400ms ease-in-out;
      --size: var(--paper-progress-circle-size, 56px);
    }
    :host([disabled]) circle {
      stroke: var(--dark-theme-disabled-color);
    }
    circle {
      height: var(--size);
      width: var(--size);
      fill: transparent;
      stroke: var(--paper-progress-circle-color, var(--light-accent-color));
      stroke-width: calc(var(--paper-progress-circle-bar-size, 6px) * 2);
      stroke-dasharray: calc(3.14 * var(--size));
      transform-origin:center center;
    }
    svg {
      height: var(--size);
      width: var(--size);
      transform-origin:center center;
      transform: rotate(-90deg);
    }

    :host(:not([active])[indeterminate]) {
      opacity: 0;
    }
    :host([indeterminate]) circle {
      animation: spinner 4s linear infinite;
    }

    @keyframes spinner {
        0% {
            stroke-dashoffset: calc(0.66 * var(--size));
            transform: rotate(0deg);
        } 50% {
            stroke-dashoffset: calc(3.14 * var(--size));
            transform: rotate(720deg);
        } 100% {
            stroke-dashoffset: calc(0.66 * var(--size));
            transform: rotate(1080deg);
        }
    }
    </style>
    <svg id="svg">
      <defs>
        <clipPath id="clip">
          <circle cx="50%" cy="50%" r="50%"></circle>
        </clipPath>
      </defs>
      <circle id="circle" cx="50%" cy="50%" r="50%" clip-path="url(#clip)"></circle>
    </svg>
  </template>
  <script>
    class PaperProgressCircle extends Polymer.Element {
      static get is () { return 'paper-progress-circle' }
      static get properties () {
        return {
          progress: {
            type: Number,
            value: 0,
            observer: '_progressChanged'
          },
          indeterminate: {
            type: Boolean,
            value: false,
            reflectToAttribute: true
          },
          active: {
            type: Boolean,
            reflectToAttribute: true,
            value: false
          },
          disabled: {
            type: Boolean,
            value: false,
            reflectToAttribute: true
          }
        }
      }

      _progressChanged (progress) {
        let size = this.offsetWidth
        if (!size) return

        this.$.circle.style.strokeDashoffset = size * Math.PI * progress + 'px'
      }
    }

    window.customElements.define(PaperProgressCircle.is, PaperProgressCircle)
  </script>
</dom-module>

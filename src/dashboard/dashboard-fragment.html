<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../layouts/fragment-layout.html">
<link rel="import" href="../dashboard/dashboard-leaderboard.html">
<link rel="import" href="../dashboard/dashboard-open-matches.html">
<link rel="import" href="../dashboard/dashboard-latest-matches.html">
<link rel="import" href="../dashboard/dashboard-stats.html">
<link rel="import" href="../styles/app-styles.html">
<link rel="import" href="../common/corpopong-icons.html">

<dom-module id="dashboard-fragment">
  <template>
    <style include="app-styles"></style>
    <style>
    dashboard-leaderboard, dashboard-open-matches, dashboard-stats {
      display: block;
      margin-bottom: 1rem;
    }

    .responsive {
      @apply --layout-horizontal;
      @apply --layout-wrap;
      @apply --layout-justified;
    }

    .responsive > * {
      @apply --layout-flex;
      -ms-flex-preferred-size: 100%;
          flex-basis: 100%;
    }

    .fab-morpher {
      position: fixed;
      width:56px;
      height: 56px;
      right:1rem;
      bottom:1rem;
      background-color: var(--accent-color);
      transform-origin: 50% 50%;
      border-radius: 50%;
      z-index: 2;
      display: none;
    }

    @media (min-width: 1100px) {
        .responsive > * {
            -ms-flex-preferred-size: 45%;
                flex-basis: 45%;
        }
        dashboard-leaderboard {
          margin-right: 1rem;
        }
    }

    </style>
    <fragment-layout title="CorpoPong" org="[[org]]" fullbleed>

      <div class="responsive">
        <dashboard-leaderboard org="[[org]]"></dashboard-leaderboard>
        <div>
          <dashboard-stats org="[[org]]"></dashboard-stats>
          <dashboard-open-matches user-uid="[[userUid]]" org="[[org]]"></dashboard-open-matches>
          <dashboard-latest-matches org="[[org]]"></dashboard-latest-matches>
        </div>
      </div>

      <paper-fab  id="fab" class="fixed-fab" icon="corpopong:paddles" on-click="_onCreateClick"></paper-fab>
    </fragment-layout>
    <div id="morpher" class="fab-morpher"></div>

  </template>
  <script>
    class DashboardFragment extends Polymer.Element {
      static get is () { return 'dashboard-fragment' }
      static get properties () {
        return {
          org: String,
          userUid: String
        }
      }
      _onCreateClick () {
        this.$.morpher.style.display = 'block'
        this.$.fab.style.display = 'none'
        let morpherLeft = this.$.morpher.getBoundingClientRect().left
        let morpherTop = this.$.morpher.getBoundingClientRect().top
        let scaleX = document.documentElement.offsetWidth / 56
        let scaleY = document.documentElement.offsetHeight / 56
        let morpherColor = window.getComputedStyle(this.$.morpher).backgroundColor

        this.$.morpher.animate([
          {right: '1rem', left: `${morpherLeft}px`},
          {right: `50%`, left: 'calc(50% - 28px)'}
        ], {
          duration: 250,
          easing: 'ease-out'
        })
        this.$.morpher.animate([
          {bottom: '1rem', top: `${morpherTop}px`},
          {bottom: `50%`, top: 'calc(50% - 28px)'}
        ], {
          duration: 250,
          easing: 'ease-in'
        }).onfinish = () => {
          this.$.morpher.style.right = '50%'
          this.$.morpher.style.left = 'calc(50% - 28px)'
          this.$.morpher.style.bottom = '50%'
          this.$.morpher.style.top = 'calc(50% - 28px)'
        }
        this.$.morpher.animate([
          {transform: 'scale(1,1)', borderRadius: '50%', backgroundColor: morpherColor},
          {transform: `scale(${scaleX}, ${scaleY})`, borderRadius: '0', backgroundColor: '#FFF'}
        ], {
          duration: 250,
          delay: 100,
          easing: 'ease-in'
        }).onfinish = () => {
          this.$.morpher.style.transform = `scale(${scaleX}, ${scaleY})`
          this.$.morpher.style.borderRadius = '0'
          this.$.morpher.style.backgroundColor = '#FFF'
          setTimeout(() => {
            this.dispatchEvent(new CustomEvent('create-match-click'))
            this.$.morpher.style = null
            this.$.fab.style = null
          }, 50)
        }
      }
    }

    window.customElements.define(DashboardFragment.is, DashboardFragment)
  </script>
</dom-module>
